#This file is part of Vulture OS.
#
#Vulture OS is free software: you can redistribute it and/or modify
#it under the terms of the GNU General Public License as published by
#the Free Software Foundation, either version 3 of the License, or
#(at your option) any later version.

#Vulture OS is distributed in the hope that it will be useful,
#but WITHOUT ANY WARRANTY; without even the implied warranty of
#MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#GNU General Public License for more details.

#You should have received a copy of the GNU General Public License
#along with Vulture OS.  If not, see http://www.gnu.org/licenses/.

########################## WARNING ###############################
# Don't edit this file, it is automatically generated by Vulture #
########################## WARNING ###############################

# File templates
{% for forwarder in node.pstats_forwarders.filter(logomfile__isnull=False) %}
    {{forwarder.logomfile.render_file_template("pstats")}}
{% endfor %}


ruleset(name="ruleset-pstats") {
    # set global variable for uptime
    if not $/starttime then set $/starttime = parse_time($timestamp);

    # Parse json for correct formatting in template
    action(type="mmjsonparse" cookie="" container="$!parsed")
    set $!parsed!techno = "parse";
    set $!parsed!product = "stats";

    # Log each minutes in /var/log/pstats
    if substring($timegenerated, 13, 15) == "00" then {
        action(type="omfile" file="/var/log/pstats")
    }

    {% for forwarder in node.pstats_forwarders.all() %}
        {{ forwarder.generate_conf(forwarder.select_log_om(forwarder.id), "pstats", frontend="internal_pstats") }}
    {% endfor %}

	stop
}
