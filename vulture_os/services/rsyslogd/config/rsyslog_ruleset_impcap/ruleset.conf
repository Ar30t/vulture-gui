#This file is part of Vulture OS.
#

########################## WARNING ###############################
# Don't edit this file, it is automatically generated by Vulture #
########################## WARNING ###############################

ruleset(name="{{ frontend.ruleset_name }}") {

    # Data parsing is not needed, messages are already JSONified

    # Reputation contexts
    {% for f_reputation_ctx in frontend.reputation_ctxs %}
    {% if f_reputation_ctx.enabled %}
    action( type="mmdblookup"
            mmdbfile="{{f_reputation_ctx.reputation_ctx.get_filename()}}"
            fields=["!ctx_tags"]
            key="!{{f_reputation_ctx.arg_field}}")
    {% endif %}
    {% endfor %}

    {% if frontend.reputation_database_v4 -%}
    # If ethernet type is IP (v4)
    if $!impcap!ETH_type == 2048 {
        action(type="mmdblookup" mmdbfile="{{frontend.reputation_database_v4}}" fields=["!reputation"] key="!net_src_ip")
    }
    {%- endif %}
    {% if frontend.reputation_database_v6 -%}
    # If ethernet type is IPv6
    if $!impcap!ETH_type == 34525 {
        action(type="mmdblookup" mmdbfile="{{frontend.reputation_database_v6}}" fields=["!reputation"] key="!net_src_ip")
    }
    {%- endif %}
    {% if frontend.geoip_database -%}
    action(type="mmdblookup" mmdbfile="{{frontend.geoip_database}}" fields=["!geoip"] key="!net_src_ip")
    {%- endif %}

    {% include "rsyslog_darwin/ruleset.conf" %}

    set $!frontend_name = "{{frontend.name}}";

    {{ frontend.log_condition }}

    stop
}
